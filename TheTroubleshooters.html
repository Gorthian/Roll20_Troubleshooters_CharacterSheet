<!--
	CREATED by 			Richard M
	EDITED by 			Gorthian
	Version				3.0a
	Letzte Änderung		2022-07-31
	
	GitHub				https://github.com/Gorthian/Roll20_Troubleshooters_CharacterSheet
	Wiki				https://github.com/Gorthian/Roll20_Troubleshooters_CharacterSheet/wiki
	Bugs & Issues		https://github.com/Gorthian/Roll20_Troubleshooters_CharacterSheet/issues
//-->

<input style="display:none;" type="checkbox" class="sheet-isnpc-check" name="attr_isnpc" value="1" />
<div class="sheet-ts">
	<div class="sheet-header">
		<div>
			<img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/The Troubleshooters/Logo-Black.png" class="sheet-logo" title="" data-i18n-title="image-disclaimer">
		</div>
		<div></div>
		<div style="border: 1px black solid; padding: 10px;">
			<div class="sheet-pcstats">
				<input type="number" name="attr_vitality" class="sheet-number" min="0" max="20" title="Current Vitality" data-i18n-title="current-vitality"/> / <input type="number" name="attr_vitality_max_vis" class="sheet-skill" value="4" readonly="true" title="Max Vitality (based on skill values & conditions)" data-i18n-title="max-vitality"/>
				<input type="hidden" class="sheet-number" name="attr_vitality_max"  value="4"/>&nbsp;|&emsp;&emsp;
				<input type="number" name="attr_storypoints" class="sheet-number" value="3" min="0" max="12" title="Story Points" data-i18n-title="story-points"/>&emsp;&emsp;|&emsp;
				<input type="number" name="attr_advancements" class="sheet-number" value="0" min="0" max="10" title="Advancement / Reward Rolls" data-i18n-title="advancement"/>
				<br>
				&ensp;<label style="display: inline; font-size: 1em" data-i18n="vitality-max">Vitality / Max</label>&ensp;&nbsp;|&ensp;
				<label style="display: inline; font-size: 1em" data-i18n="story-points">Story Points</label>&nbsp;|&nbsp; 
				<label style="display: inline; font-size: 1em" data-i18n="advances">Advances</label>
			</div>
			<br/>
			<span style="display:none" data-i18n="how-many-dice">How many dice</span>
			&emsp;<button type="roll" class="sheet-blank-button" value="&{template:basic} {{name=@{name}}} {{result=[[?{@{how_many_dice}|1}d6]]}} {{dicetype=d6}} {{dicecount=?{@{how_many_dice}|1}}}" title="Summing Dice" data-i18n-title="summing-dice-title" data-i18n="summing-dice">Nd6</button>
			&emsp;<button type="roll" class="sheet-blank-button" value="&{template:basic} {{name=@{name}}} {{result=[[?{@{how_many_dice}|1}d6>4]]}} {{dicetype=d6P}} {{dicecount=?{@{how_many_dice}|1}}}" title="Non-exploding Dice Pool" data-i18n-title="non-exploding-pool-title" data-i18n="non-exploding-pool">NdP</button>
			&emsp;<button type="roll" class="sheet-blank-button" value="&{template:basic} {{name=@{name}}} {{result=[[?{@{how_many_dice}|1}d6!>6>4]]}} {{dicetype=d6X}} {{dicecount=?{@{how_many_dice}|1}}}" title="Exploding Dice Pool" data-i18n-title="exploding-pool-title" data-i18n="exploding-pool">NdX</button>
			&emsp;<button type="roll" class="sheet-blank-button" value="&{template:basic} {{name=@{name}}} {{result=[[1d100]]}} {{dicetype=d%}} {{dicecount=1}}" title="Percentile Dice" data-i18n-title="percentile-dice-title" data-i18n="percentile-dice">d100</button>
			&emsp;<span data-i18n="npc">add text in translation files</span> : <input type="checkbox" class="sheet-isnpc-check" name="attr_isnpc" value="1" />
		</div>
	</div>	
	<br/>
	<input type="radio" class="sheet-page1" name="attr_page" value="1" checked="checked" id="sheet-page1">
		<label for="sheet-page1" class="sheet-pagetab sheet-pc-view" data-i18n="cover">COVER</label>
	<input type="radio" class="sheet-page2" name="attr_page" value="2" id="sheet-page2">
		<label for="sheet-page2" class="sheet-pagetab sheet-pc-view" data-i18n="character">CHARACTER</label>
	<input type="radio" class="sheet-page3" name="attr_page" value="3" id="sheet-page3">
		<label for="sheet-page3" class="sheet-pagetab sheet-pc-view" data-i18n="skills">SKILLS</label>
	<input type="radio" class="sheet-page4" name="attr_page" value="4" id="sheet-page4">
		<label for="sheet-page4" class="sheet-pagetab sheet-pc-view" data-i18n="gear-visas">GEAR / VISAS</label>
	<input type="radio" class="sheet-page5" name="attr_page" value="5" id="sheet-page5">
		<label for="sheet-page5" class="sheet-pagetab sheet-pc-view" data-i18n="journal">JOURNAL</label>
	<input type="radio" class="sheet-page6" name="attr_page" value="6" id="sheet-page6">
		<label for="sheet-page6" class="sheet-pagetab sheet-pc-view" data-i18n="combat">COMBAT</label>	
	<input type="radio" class="sheet-page7" name="attr_page" value="7" id="sheet-page7">
		<label for="sheet-page7" class="sheet-pagetab sheet-npc-view" data-i18n="npc">NPC</label>	

	<div class="sheet-cover sheet-pc-view">
		<img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/The Troubleshooters/Achievement_col.png" class="sheet-shield" title="" data-i18n-title="image-disclaimer">
		<br />	

		<h2 data-i18n="emergency-passport">EMERGENCY PASSPORT<br/>PASSEPORT TEMPORAIRE<br/>PASSERSATZ</h2>
		<br />

		<input class="sheet-coverfluff" type="text" name="attr_passport_number" placeholder="Passport Number" data-i18n-placeholder="passport-number"/><br /><h3 data-i18n="no-of-passport">No of Passport / No du Passeport / Nummer des Reisepasses</h3>
		<br />
		<input class="sheet-coverfluff" type="text" name="attr_character_name" placeholder="Name" data-i18n-placeholder="name"/><br /><h3 data-i18n="name-of-bearer">Name of bearer / Nom du titulaire / Name des Passinhabers</h3> 
		<br />
		<input class="sheet-coverfluff" type="text" name="attr_nationality" placeholder="Nationality" data-i18n-placeholder="nationality"/><br /><h3 data-i18n="national-status">National status / Nationalité / Staatsangehörigkeit</h3>
		<br />
	</div>

	<div class="sheet-character sheet-pc-view">
		<div class="sheet-passport">
			<div>

				<h3 data-i18n="description-title">Description / Description / Beschreibung</h3>	
				<br />

				<input class="sheet-fluff" type="text" name="attr_profession" placeholder="Profession" data-i18n-placeholder="profession"/> <br />
				<h4 data-i18n="profession-title">Profession / Profession / Beruf</h4>	
				<input class="sheet-fluff" type="text" name="attr_surname" placeholder="Family name" data-i18n-placeholder="family-name"/><br />
				<h4 data-i18n="family-name-title">Name / Nom / Name</h4>
				<input class="sheet-fluff" type="text" name="attr_name" placeholder="Given name" data-i18n-placeholder="given-name"/><br />
				<h4 data-i18n="given-name-title">Given name / Prénom / Vornamen</h4>
				<input class="sheet-fluff" type="text" name="attr_residence" placeholder="Place of residence" data-i18n-placeholder="residence"/><br />
				<h4 data-i18n="residence-title">Residence / Domicile / Wohnort</h4>
				<input class="sheet-fluff" type="text" name="attr_height" placeholder="Height" data-i18n-placeholder="height"/><br />
				<h4 data-i18n="height-title">Height / Taille / Größe</h4>
				<input class="sheet-fluff" type="text" name="attr_eyecolour" placeholder="Eye colour" data-i18n-placeholder="eye-color"/><br />
				<h4 data-i18n-placeholder="eye-color-title">Colour of eyes / Couleur des yeux / Augenfarbe</h4>
				<input class="sheet-fluff" type="text" name="attr_haircolour" placeholder="Hair colour" data-i18n-placeholder="hair-color"/><br />
				<h4 data-i18n="hair-color-title">Colour of hair / Couleur des cheveux / Haarfarbe</h4>
				<input class="sheet-fluff" type="text" name="attr_marks" placeholder="Distinguishing marks" data-i18n-placeholder="distinguishing-marks"/><br />
				<input class="sheet-fluff" type="text" name="attr_marks2" /><br />	
				<h4 data-i18n="distinguishing-marks-title">Distinguishing marks / Signes particuliers / Unveränderliche Kennzeichen</h4>
				<input class="sheet-fluff" type="text" name="attr_dob" placeholder="Date of birth" data-i18n-placeholder="date-of-birth"/><br />
				<h4 data-i18n="date-of-birth-title">Date of birth / Date de naissance / Geburtsdatum</h4>
				<input class="sheet-fluff" type="text" name="attr_birthplace" placeholder="Birthplace" data-i18n-placeholder="birthplace"/><br />
				<h4 data-i18n-placeholder="birthplace-title">Place of birth / Lieu de naissance / Geburtsort</h4>
				<input class="sheet-fluff" type="text" name="attr_character_name" placeholder="Signature" data-i18n-placeholder="signature" style="font-family: Parisienne"/><br />
				<h4 data-i18n="signature-title">Holder's signature/ Signature du titulaire / Unterschrift des Passinhabers</h4>
		
			</div>
		
			<div>
				<div class="sheet-mugshot">
					<img class="sheet-portrait" name="attr_character_avatar" height="350px" width="auto"/>
					<div class="sheet-caption" data-i18n="photo-title">Photo of holder/Photo du titulaire/Foto des Passinhabers</div>
				</div>
				<br/>
				<h3 data-i18n="language-title">Native language(s) / Langue(s) maternelle / Muttersprache(n)</h3>
						
					<input class="sheet-fluff" type="text" name="attr_language1" placeholder="Language" data-i18n-placeholder="language" style="width: 45%"/>
					<input class="sheet-fluff" type="text" name="attr_language2" placeholder="Language" data-i18n-placeholder="language" style="width: 45%"/>
					<br />
				<br/>	
				<h3 data-i18n="fluent-language-title">Fluent languages / Langues parlées / Sprachkenntnisse</h3>
						
					<fieldset class="repeating_languages">
						<input class="sheet-fluff" type="text" name="attr_language" placeholder="Language" data-i18n-placeholder="language" style="width: 45%"/>
						<input class="sheet-skill" type="text" placeholder="Cost" data-i18n-placeholder="cost" style="width: 8ch"/>
						<div class="radiocontainer">
							<input type="radio" checked="checked" class="radiobox reset" name="attr_languagetick" value="0">
							<input type="radio" class="radiobox" name="attr_languagetick" value="1">
							<input type="radio" class="radiobox" name="attr_languagetick" value="2">
							<input type="radio" class="radiobox" name="attr_languagetick" value="3">
							<input type="radio" class="radiobox" name="attr_languagetick" value="4">
							<input type="radio" class="radiobox" name="attr_languagetick" value="5">
						</div>
					</fieldset>
				<br />
				<h3 data-i18n="contacts-title">Contacts / Contacts / Kontakte</h3>
						
					<input class="sheet-fluff" type="text" name="attr_plothook1" placeholder="Plot hook/Accroche scénaristique/Handlungsstrang" data-i18n-placeholder="plot-hook"/>
					<input class="sheet-fluff" type="text" name="attr_plothook2" placeholder="Plot hook/Accroche scénaristique/Handlungsstrang" data-i18n-placeholder="plot-hook"/>

			</div>
		</div>
	</div>

	<div class="sheet-skills sheet-npc">

		<div class="sheet-passport">
			<div>
				<div class="sheet-pc-view">
					<h3 data-i18n="complications-title">Complications / Desavantages / Komplikationen</h3>
					<br/>			
					<fieldset class="repeating_complications">
						<details>
							<summary><input type="text" name="attr_complication" placeholder="Complication" data-i18n-placeholder="complication"/></summary>  
							<textarea name="attr_compdesc" placeholder="Description" data-i18n-placeholder="description" style="width:95%"></textarea>
						</details>
					</fieldset>	
					<br/>
					<h3 data-i18n="abilities-title">Abilities / Capacites / Fahigkeiten</h3>
					<br/>		
					<fieldset class="repeating_abilities">
						<details>
							<summary><input type="text" name="attr_ability" placeholder="Ability" data-i18n-placeholder="ability"/>
							<input class="sheet-skill" type="text" placeholder="Cost" data-i18n-placeholder="cost" style="width: 8ch"/>
							<input type="checkbox" name="attr_abilitytick1" value="1"/>
							<input type="checkbox" name="attr_abilitytick2" value="1"/>
							<input type="checkbox" name="attr_abilitytick3" value="1"/>
							<input type="checkbox" name="attr_abilitytick4" value="1"/>
							<input type="checkbox" name="attr_abilitytick5" value="1"/>
							<input type="checkbox" name="attr_abilitytick6" value="1"/>
							<input type="checkbox" name="attr_abilitytick7" value="1"/>
							<input type="checkbox" name="attr_abilitytick8" value="1"/></summary>
							<textarea name="attr_abilitydesc" placeholder="Description" data-i18n-placeholder="description" style="width:95%"></textarea>
						</details>
					</fieldset>
				</div>
				<div class="sheet-npc-view">
					<input type="text" name="attr_character_name" placeholder="Name" data-i18n-placeholder="name" style="width:25%"/>
					<input type="text" name="attr_name" placeholder="Chat Name" data-i18n-placeholder="chatname" style="width:15%"/>
					<input type="text" name="attr_npcaffiliation" placeholder="Affiliation" data-i18n-placeholder="affiliation" style="width:15%"/>
					<select name="attr_npclevel" style="width:15%">
						<option value="" data-i18n="rank" hidden>Rank</option>
						<option value="Mook" data-i18n="mook">Mook</option>
						<option value="Underling" data-i18n="underling">Underling</option>
						<option value="Lieutenant" data-i18n="lieutenant">Lieutenant</option>
						<option value="Boss" data-i18n="boss">Boss</option>
					</select>	
					<div>
						<label data-i18n="stats">Stats</label>
						<label class="sheet-skilllabel" data-i18n="vitality">Vitality</label><input type="number" name="attr_vitality" class="sheet-number" min="0" max="20"/>
						<label class="sheet-skilllabel" data-i18n="initiative">Initiative</label><input type="number" class="sheet-npcskill" name="attr_npcinitiative" value="0"/>
						<button type="action" class="sheet-npcroll" name="act_init_npcfix" title="NPC fixed initiative" data-i18n-title="npc-fixed-initiative" value="3" data-i18n="fixed">Fixed</button>		
						<button type="action" class="sheet-npcroll" name="act_init_npc" title="NPC rolled initiative" data-i18n-title="npc-rolled-initiative" value="2" data-i18n="roll">Roll</button><br>			
						<label class="sheet-skilllabel" data-i18n="conditional-max">Conditional Max</label><input type="number" name="attr_vitality_max_vis" class="sheet-number" value="0" readonly="true"/>
						<label class="sheet-skilllabel" data-i18n="defence">Defence</label><input type="number" class="sheet-npcskill" name="attr_npcdefence" value="0"/>
						<button type="action" class="sheet-npcroll" name="act_def_npc" title="NPC defence" data-i18n-title="npc-defence" value="3" data-i18n="roll">Roll</button><br>
						<label class="sheet-skilllabel" data-i18n="vitality-max2">Vitality Max</label><input type="number" class="sheet-number" name="attr_vitality_npc_max" title="Overrides calculated values. Should be set to 0 unless NPC" data-i18n-title="npc-vitality-info" value="0"/>
						<label class="sheet-skilllabel" data-i18n="protection">Protection</label><input type="number" name="attr_soakvalue" value="0" min="0" title="Protection value" data-i18n-title="protection-value"/><span data-i18n="dP">dP</span>
						<button type="action" class="sheet-npcroll" name="act_soak" title="NPC Protection / Armour" data-i18n-title="npc-protection" data-i18n="soak">Soak</button><br>
						<button type="action" class="sheet-cbtroll" name="act_recover" title="Recovery" data-i18n-title="recovery" data-i18n="recovery">Recovery</button>			
						<br><br>
						<label data-i18n="attacks">Attacks</label>
						<fieldset class="repeating_attacks">
							<input type="text" name="attr_npcatktxt" placeholder="Attack" data-i18n-placeholder="attack" style="width:25%"/>
							<input type="number" name="attr_npcattack" class="sheet-npcskill" value = "15" min="0" title="Attack skill" data-i18n-title="attack-skill"/>
							<input type="number" name="attr_npcweapondmg" value="0" min="0" title="Damage dice" data-i18n-title="damage-dice"/><span data-i18n="dX">dX</span>
							<input type="text" name="attr_npcweapontags" placeholder="Tags" data-i18n-placeholder="tags"/>
							<input type="number" name="attr_npcreloadval" title="Reload: Enter lower tag value OR use 99 for single-shot and melee weapons" data-i18n-title="npc-reload-info" value="99" min="0"/>	
							<button type="action" class="sheet-npcroll" name="act_atknpc" title="NPC attack" data-i18n-title="npc-attack" data-i18n="roll">Roll</button><br>
						</fieldset>	
					</div>
					<div>		
						<label data-i18n="tags">Tags</label>			
						<textarea name="attr_npctags" placeholder="Tags" data-i18n-placeholder="tags" style="height: 40px"></textarea>
						<br>
					</div>			
				</div>
			</div>

			<div>

				<div class="sheet-2colrow">

					<h3 data-i18n="skills-title">Skills / Competences / Kompetenzen</h3>
					<br/>
				
					<div class="sheet-pc-view">
						<div class="sheet-col" style="width: 45%; margin: 0px">
							<button type="action" class="sheet-skillroll" name="act_skillroll" title="Agility" data-i18n-title="agility" value="agility-skillroll" data-i18n="agility">Agility</button><input type="number" name="attr_agility" class="sheet-skill" value = "15" min="0" style="width: 2.5em; text-align: right"/>
							<input type="checkbox" name="attr_agilityused" value="1" title="Check when used" data-i18n-title="check-when-used"/>
							<br />
							<button type="action" class="sheet-skillroll" name="act_skillroll" title="Alertness" data-i18n-title="alertness" value="alertness-skillroll" data-i18n="alertness">Alertness</button><input type="number" name="attr_alertness" class="sheet-skill" value = "15" min="0" style="width: 2.5em; text-align: right"/>
							<input type="checkbox" name="attr_alertnessused" value="1" title="Check when used" data-i18n-title="check-when-used"/>
							<br />
							<button type="action" class="sheet-skillroll" name="act_skillroll" title="Charm" data-i18n-title="charm" value="charm-skillroll" data-i18n="charm">Charm</button><input type="number" name="attr_charm" class="sheet-skill" value = "15" min="0" style="width: 2.5em; text-align: right"/>
							<input type="checkbox" name="attr_charmused" value="1" title="Check when used" data-i18n-title="check-when-used"/>
							<br />
							<button type="action" class="sheet-skillroll" name="act_skillroll" title="Contacts" data-i18n-title="contacts" value="contacts-skillroll" data-i18n="contacts">Contacts</button><input type="number" name="attr_contacts" class="sheet-skill" value = "15" min="0" style="width: 2.5em; text-align: right"/>
							<input type="checkbox" name="attr_contactsused" value="1" title="Check when used" data-i18n-title="check-when-used"/>
							<br />
							<button type="action" class="sheet-skillroll" name="act_skillroll" title="Credit" data-i18n-title="credit" value="credit-skillroll" data-i18n="credit">Credit</button><input type="number" name="attr_credit" class="sheet-skill" value = "15" min="0" style="width: 2.5em; text-align: right"/>
							<input type="checkbox" name="attr_creditused" value="1" title="Check when used" data-i18n-title="check-when-used"/>
							<br />
							<button type="action" class="sheet-skillroll" name="act_skillroll" title="Electronics" data-i18n-title="electronics" value="electronics-skillroll" data-i18n="electronics">Electronics</button><input type="number" name="attr_electronics" class="sheet-skill" value = "15" min="0" style="width: 2.5em; text-align: right"/>
							<input type="checkbox" name="attr_electronicsused" value="1" title="Check when used" data-i18n-title="check-when-used"/>
							<br />
							<button type="action" class="sheet-skillroll" name="act_skillroll" title="Endurance" data-i18n-title="endurance" value="endurance-skillroll" data-i18n="endurance">Endurance</button><input type="number" name="attr_endurance" class="sheet-skill" value = "15" min="0" style="width: 2.5em; text-align: right"/>
							<input type="checkbox" name="attr_enduranceused" value="1" title="Check when used" data-i18n-title="check-when-used"/>
							<br />
							<button type="action" class="sheet-skillroll" name="act_skillroll" title="Engineering" data-i18n-title="engineering" value="engineering-skillroll" data-i18n="engineering">Engineering</button><input type="number" name="attr_engineering" class="sheet-skill" value = "15" min="0" style="width: 2.5em; text-align: right"/>
							<input type="checkbox" name="attr_engineeringused" value="1" title="Check when used" data-i18n-title="check-when-used"/>
							<br />
							<button type="action" class="sheet-skillroll" name="act_skillroll" title="Entertainment" data-i18n-title="entertainment" value="entertainment-skillroll" data-i18n="entertainment">Entertainment</button><input type="number" name="attr_entertainment" class="sheet-skill" value = "15" min="0" style="width: 2.5em; text-align: right"/>
							<input type="checkbox" name="attr_entertainmentused" value="1" title="Check when used" data-i18n-title="check-when-used"/>
							<br />
							<button type="action" class="sheet-skillroll" name="act_skillroll" title="Humanities" data-i18n-title="humanities" value="humanities-skillroll" data-i18n="humanities">Humanities</button><input type="number" name="attr_humanities" class="sheet-skill" value = "15" min="0" style="width: 2.5em; text-align: right"/>
							<input type="checkbox" name="attr_humanitiesused" value="1" title="Check when used" data-i18n-title="check-when-used"/>
							<br />
							<button type="action" class="sheet-skillroll" name="act_skillroll" title="Investigation" data-i18n-title="investigation" value="investigation-skillroll" data-i18n="investigation">Investigation</button><input type="number" name="attr_investigation" class="sheet-skill" value = "15" min="0" style="width: 2.5em; text-align: right"/>
							<input type="checkbox" name="attr_investigationused" value="1" title="Check when used" data-i18n-title="check-when-used"/>
							<br />
							<button type="action" class="sheet-skillroll" name="act_skillroll" title="Languages" data-i18n-title="languages" value="languages-skillroll" data-i18n="languages">Languages</button><input type="number" name="attr_languages" class="sheet-skill" value = "15" min="0" style="width: 2.5em; text-align: right"/>
							<input type="checkbox" name="attr_languagesused" value="1" title="Check when used" data-i18n-title="check-when-used"/>
							<br />
							<button type="action" class="sheet-skillroll" name="act_skillroll" title="Machinery" data-i18n-title="machinery" value="machinery-skillroll" data-i18n="machinery">Machinery</button><input type="number" name="attr_machinery" class="sheet-skill" value = "15" min="0" style="width: 2.5em; text-align: right"/>
							<input type="checkbox" name="attr_machineryused" value="1" title="Check when used" data-i18n-title="check-when-used"/>
							<br />
							<button type="action" class="sheet-skillroll" name="act_skillroll" title="Medicine" data-i18n-title="medicine" value="medicine-skillroll" data-i18n="medicine">Medicine</button><input type="number" name="attr_medicine" class="sheet-skill" value = "15" min="0" style="width: 2.5em; text-align: right"/>
							<input type="checkbox" name="attr_medicineused" value="1" title="Check when used" data-i18n-title="check-when-used"/>
							<br />
						</div>
						
						<div class="sheet-col" style="width: 45%; margin: 0px; border-left: 1px solid black; padding-left: 5px">		
							<button type="action" class="sheet-skillroll" name="act_skillroll" title="Melee" data-i18n-title="melee" value="melee-skillroll" data-i18n="melee">Melee</button><input type="number" name="attr_melee" class="sheet-skill" value = "15" min="0" style="width: 2.5em; text-align: right"/>
							<input type="checkbox" name="attr_meleeused" value="1" title="Check when used" data-i18n-title="check-when-used"/>
							<br />
							<button type="action" class="sheet-skillroll" name="act_skillroll" title="Prestidigitation" data-i18n-title="prestidigitation" value="prestidigitation-skillroll" data-i18n="prestidigitation">Prestidigitation</button><input type="number" name="attr_prestidigitation" class="sheet-skill" value = "15" min="0" style="width: 2.5em; text-align: right"/>
							<input type="checkbox" name="attr_prestidigitationused" value="1" title="Check when used" data-i18n-title="check-when-used"/>
							<br />
							<button type="action" class="sheet-skillroll" name="act_skillroll" title="RangedCombat" data-i18n-title="rangedcombat" value="rangedcombat-skillroll" data-i18n="rangedcombat">Ranged Combat</button><input type="number" name="attr_rangedcombat" class="sheet-skill" value = "15" min="0" style="width: 2.5em; text-align: right"/>
							<input type="checkbox" name="attr_rangedused" value="1" title="Check when used" data-i18n-title="check-when-used"/>
							<br />
							<button type="action" class="sheet-skillroll" name="act_skillroll" title="RedTape" data-i18n-title="redtape" value="redtape-skillroll" data-i18n="redtape">Red Tape</button><input type="number" name="attr_redtape" class="sheet-skill" value = "15" min="0" style="width: 2.5em; text-align: right"/>
							<input type="checkbox" name="attr_redtapeused" value="1" title="Check when used" data-i18n-title="check-when-used"/>
							<br />
							<button type="action" class="sheet-skillroll" name="act_skillroll" title="Science" data-i18n-title="science" value="science-skillroll" data-i18n="science">Science</button><input type="number" name="attr_science" class="sheet-skill" value = "15" min="0" style="width: 2.5em; text-align: right"/>
							<input type="checkbox" name="attr_scienceused" value="1" title="Check when used" data-i18n-title="check-when-used"/>
							<br />
							<button type="action" class="sheet-skillroll" name="act_skillroll" title="Search" data-i18n-title="search" value="search-skillroll" data-i18n="search">Search</button><input type="number" name="attr_search" class="sheet-skill" value = "15" min="0" style="width: 2.5em; text-align: right"/>
							<input type="checkbox" name="attr_searchused" value="1" title="Check when used" data-i18n-title="check-when-used"/>
							<br />
							<button type="action" class="sheet-skillroll" name="act_skillroll" title="Security" data-i18n-title="security" value="security-skillroll" data-i18n="security">Security</button><input type="number" name="attr_security" class="sheet-skill" value = "15" min="0" style="width: 2.5em; text-align: right"/>
							<input type="checkbox" name="attr_securityused" value="1" title="Check when used" data-i18n-title="check-when-used"/>
							<br />
							<button type="action" class="sheet-skillroll" name="act_skillroll" title="Sneak" data-i18n-title="sneak" value="sneak-skillroll" data-i18n="sneak">Sneak</button><input type="number" name="attr_sneak" class="sheet-skill" value = "15" min="0" style="width: 2.5em; text-align: right"/>
							<input type="checkbox" name="attr_sneakused" value="1" title="Check when used" data-i18n-title="check-when-used"/>
							<br />
							<button type="action" class="sheet-skillroll" name="act_skillroll" title="Status" data-i18n-title="status" value="status-skillroll" data-i18n="status">Status</button><input type="number" name="attr_status" class="sheet-skill" value = "15" min="0" style="width: 2.5em; text-align: right"/>
							<input type="checkbox" name="attr_statusused" value="1" title="Check when used" data-i18n-title="check-when-used"/>
							<br />
							<button type="action" class="sheet-skillroll" name="act_skillroll" title="Strength" data-i18n-title="strength" value="strength-skillroll" data-i18n="strength">Strength</button><input type="number" name="attr_strength" class="sheet-skill" value = "15" min="0" style="width: 2.5em; text-align: right"/>
							<input type="checkbox" name="attr_strengthused" value="1" title="Check when used" data-i18n-title="check-when-used"/>
							<br />
							<button type="action" class="sheet-skillroll" name="act_skillroll" title="Subterfuge" data-i18n-title="subterfuge" value="subterfuge-skillroll" data-i18n="subterfuge">Subterfuge</button><input type="number" name="attr_subterfuge" class="sheet-skill" value = "15" min="0" style="width: 2.5em; text-align: right"/>
							<input type="checkbox" name="attr_subterfugeused" value="1" title="Check when used" data-i18n-title="check-when-used"/>
							<br />
							<button type="action" class="sheet-skillroll" name="act_skillroll" title="Survival" data-i18n-title="survival" value="survival-skillroll" data-i18n="survival">Survival</button><input type="number" name="attr_survival" class="sheet-skill" value = "15" min="0" style="width: 2.5em; text-align: right"/>
							<input type="checkbox" name="attr_survivalused" value="1" title="Check when used" data-i18n-title="check-when-used"/>
							<br />
							<button type="action" class="sheet-skillroll" name="act_skillroll" title="Vehicles" data-i18n-title="vehicles" value="vehicles-skillroll" data-i18n="vehicles">Vehicles</button><input type="number" name="attr_vehicles" class="sheet-skill" value = "15" min="0" style="width: 2.5em; text-align: right"/>
							<input type="checkbox" name="attr_vehiclesused" value="1" title="Check when used" data-i18n-title="check-when-used"/>
							<br />
							<button type="action" class="sheet-skillroll" name="act_skillroll" title="Willpower" data-i18n-title="willpower" value="willpower-skillroll" data-i18n="willpower">Willpower</button><input type="number" name="attr_willpower" class="sheet-skill" value = "15" min="0" style="width: 2.5em; text-align: right"/>
							<input type="checkbox" name="attr_willpowerused" value="1" title="Check when used" data-i18n-title="check-when-used"/>
						</div>
					</div>
					<div class="sheet-npc-view">
						<button type="action" class="sheet-skillroll" name="act_gennpc" title="General" data-i18n-title="general" value="general-skillroll" data-i18n="general">General</button>
						<input type="number" name="attr_general" class="sheet-npcskill" value = "15" min="0"/><br>
						<button type="action" class="sheet-skillroll" name="act_specnpc" title="Special" data-i18n-title="special" value="special-skillroll" data-i18n="specialist">Specialist</button>
						<input type="number" name="attr_special" class="sheet-npcskill" value = "15" min="0"/><br>
						<fieldset class="repeating_skills">
							<input type="text" class="sheet-skilllabel" name="attr_npcskilltext" placeholder="Skill" data-i18n-placeholder="skill" />
							<input type="number" name="attr_skillnpc" class="sheet-npcskill" value = "15" min="0"/>
							<button type="action" class="sheet-npcroll" name="act_skillnpc" title="Other skills" data-i18n-title="other-skills" data-i18n="roll">Roll</button><br>
						</fieldset><br>	
					</div>
				</div>
		
				<hr />
				<h3 data-i18n="conditions-title">Conditions</h3>
				<br/>
				<div class="sheet-2colrow">
					<div class="sheet-col">
						<label class="sheet-conditionlabel" title="All checks to notice something by sight automatically fail. All checks for Search and Investigation, and all Attack checks and Defence checks are at −5 pips. Many actions, like reading, are impossible. If the cause of the blindness is due to darkness, drop the Blinded Condition when light is restored. If the cause of the blindness is temporary, drop the Blinded Condition after the scene." data-i18n-title="blinded-info" data-i18n="blinded">Blinded</label><input class="sheet-showcondition" type="checkbox" name="attr_blinded" value="1"/>
						<br/>
						<label class="sheet-conditionlabel" title="All checks to notice something by hearing automatically fail. Checks for Charm, Languages, Entertainment and even Contacts and Sneak can be at −2 or −5 pips. If the cause of the deafness is a sudden loud sound, drop the Deaf Condition after the scene." data-i18n-title="deaf-info" data-i18n="deaf">Deaf</label><input class="sheet-showcondition" type="checkbox" name="attr_deaf" value="2"/>
						<br/>
						<label class="sheet-conditionlabel" title="Temporarily halve your Max Vitality. If your vitality exceeds the temporary Max Vitality, your current Vitality is equal to your temporary Max Vitality. Exhausted Conditions stack. Drop one Exhausted Condition after eating, rehydrating and having a good night’s sleep." data-i18n-title="exhausted-info" data-i18n="exhausted">Exhausted</label><input class="sheet-showcondition" type="checkbox" name="attr_exhausted1" value="3"/><input class="sheet-showcondition" type="checkbox" name="attr_exhausted2" value="3"/><input class="sheet-showcondition" type="checkbox" name="attr_exhausted3" value="3"/>
						<br/>
						<label class="sheet-conditionlabel" title="You cannot enter the same zone as the source of your fright. Attack checks are at −2 pips. Drop the Frightened Condition by making a successful Willpower task check as your main action." data-i18n-title="frightened-info" data-i18n="frightened">Frightened</label><input class="sheet-showcondition" type="checkbox" name="attr_frightened" value="4"/>
						<br/>
						<label class="sheet-conditionlabel" title="All task checks are at −2 pips. You can’t take defence actions at all. You gain 1d6 Protection. The Intoxicated Condition stacks up to three times. You don’t get a fourth Intoxicated Condition, but instead collapse and fall unconscious (counts as Out Cold). Drop one Intoxicated Condition the next morning, and then another at each six-hour interval thereafter." data-i18n-title="intoxicated-info" data-i18n="intoxicated">Intoxicated</label><input class="sheet-showcondition" type="checkbox" name="attr_intoxicated1" value="5"/><input class="sheet-showcondition" type="checkbox" name="attr_intoxicated2" value="5"/><input class="sheet-showcondition" type="checkbox" name="attr_intoxicated3" value="5"/>
						<br/>
						<label class="sheet-conditionlabel" title="Take the Mortal Peril Condition instead of Vitality loss. You can only take the Mortal Peril Condition if you do not already have the Mortal Peril Condition. Flip any Attack check for the remainder of the fight. If Vitality runs out in the current fight, you die, unconditionally." data-i18n-title="mortalperil-info" data-i18n="mortalperil">Mortal Peril</label><input class="sheet-showcondition" type="checkbox" name="attr_mortalperil" value="6"/>
						<br/>					
						<label class="sheet-conditionlabel" title="At the start of your turn, take 1dX Damage. If you are Out Cold at the start of your turn and still On Fire, take one Wounded Condition. You can take a Main action to try to put out the fire if you are in a zone that is not on fire. Make an Agility task check. If successful, drop the On Fire Condition. Someone else can also put out the fire in the same way on their turn. If you have a blanket or other fire-extinguishing tool, the task check is at +2 pips or more." data-i18n-title="onfire-info" data-i18n="onfire">On Fire</label><input class="sheet-showcondition" type="checkbox" name="attr_onfire" value="7"/>
						<br/>
						<label class="sheet-conditionlabel" title="When Vitality runs out, you’re Out Cold and you are no longer in the fight. Drop the Out Cold Condition at the start of the next scene if another character makes a successful Medicine task check. Drop the Condition at the start of the scene after that if the task check failed or if there was no Medicine task check." data-i18n-title="outcold-info" data-i18n="outcold">Out Cold</label><input class="sheet-showcondition" type="checkbox" name="attr_outcold" value="8"/>
					</div>
					<div class="sheet-col">
						<label class="sheet-conditionlabel" title="When Overburdened, movement and attack checks are at −2 pips. Drop the Overburdened Condition as a Free action if you can put down or drop the items that make you Overburdened. Drop the Overburdened Condition as a main action if you have to wriggle out of a harness to put down the items that make you Overburdened." data-i18n-title="overburdened-info" data-i18n="overburdened">Overburdened</label><input class="sheet-showcondition" type="checkbox" name="attr_overburdened" value="9"/>
						<br/>
						<label class="sheet-conditionlabel" title="You can’t take any actions on your turn. At the end of your turn, make an Endurance task check. If successful, “unlock” one kind of action (Free, Move, Main or Bonus) for the rest of the scene. Depending on the reason for the paralysis, there may be a modifier on the task check. Drop the Paralysed Condition when the source of the paralysis says it should be dropped." data-i18n-title="paralysed-info" data-i18n="paralysed">Paralysed</label><input class="sheet-showcondition" type="checkbox" name="attr_paralysed" value="10"/>
						<br/>
						<label class="sheet-conditionlabel" title="You can’t take a Move action. You can take a Sprint action, but it requires an Agility task check. Ranged Attack checks made against you from another zone are at −2 pips. Your Defence checks against melee attacks or ranged attacks from the same zone are at −2 pips. At the end of your turn, you may get up and drop the Prone Condition as a bonus action." data-i18n-title="prone-info" data-i18n="prone">Prone</label><input class="sheet-showcondition" type="checkbox" name="attr_prone" value="11"/>
						<br/>
						<label class="sheet-conditionlabel" title="You cannot take a Move action or Sprint action. Drop the Restrained Condition by making a successful Unarmed Melee, Strength or Agility task check as your Main action. The check is opposed if another character is holding you. If the check fails, or if you lose, you’re still Restrained." data-i18n-title="restrained-info" data-i18n="restrained">Restrained</label><input class="sheet-showcondition" type="checkbox" name="attr_restrained" value="12"/>
						<br/>
						<label class="sheet-conditionlabel" title="Attack checks are at −5 pips. Sprint or Move actions that normally require a task check are also at −5 pips. Regular Sprint or Move actions now require a task check. Other task checks are at −2 pips. Unless being Stunned is the result of poison or illness, you can often use your Main action to make a Willpower task check. If successful, drop the Stunned Condition. Drop the Stunned Condition at the start of the next scene if it is still in effect." data-i18n-title="stunned-info" data-i18n="stunned">Stunned</label><input class="sheet-showcondition" type="checkbox" name="attr_stunned" value="13"/>
						<br/>
						<label class="sheet-conditionlabel" title="Whenever you are surprised, caught unprepared, or otherwise not ready for action, you get the Surprised Condition. You can only take a Free action on your turn. Drop the Surprised Condition at the end of your turn." data-i18n-title="surprised-info" data-i18n="surprised">Surprised</label><input class="sheet-showcondition" type="checkbox" name="attr_surprised" value="14"/>
						<br/>
						<label class="sheet-conditionlabel" title="All checks are at −2 pips. Attack checks against the source of your terror are at −5 pips. You cannot move closer to the source of your terror. At the start of your turn, if you are in the same zone as the source of your terror, make a Willpower task check as a Free action. If it fails, you must move out of the zone before doing anything else. Replace the Terrified Condition with the Frightened Condition by making a successful Willpower task check as your Main action." data-i18n-title="terrified-info" data-i18n="terrified">Terrified</label><input class="sheet-showcondition" type="checkbox" name="attr_terrified" value = "15" min="0"/>
						<br/>		
						<label class="sheet-conditionlabel" title="Take the Wounded Condition instead of Vitality loss. You don’t have to take the Wounded Condition if you don’t want to. You can only take the Wounded Condition if you do not already have the Wounded Condition. Once the fight ends, all further task checks are at −2 pips until the Wounded Condition heals. Ignore the effects of the Wounded Condition for one scene if someone else makes a successful Medicine task check. Drop the Wounded Condition after a two-day recuperating scene and a successful Medicine, Credits or Contacts task check (and possibly some uncomfortable questions from the police), or by spending downtime on Mend and Recuperate." data-i18n-title="wounded-info" data-i18n="wounded">Wounded</label><input class="sheet-showcondition" type="checkbox" name="attr_wounded" value="16"/>
					</div>
				</div>
				<div class="sheet-npc-view">
					<label data-i18n="notes">Notes</label>
					<textarea name="attr_npcnotes" placeholder="Notes" data-i18n-placeholder="notes" style="height:60px;"></textarea>		
				</div>
			</div>
		</div>
	</div>

	<div class="sheet-gear sheet-pc-view">
		<div class="sheet-passport">
			<div>
				<h3 data-i18n="licenses-title">Licences for dangerous items /<br/>Permis pour objets reglementes /<br/>Lizenzen fur verbotene gegenstande</h3>
				<hr />
					<fieldset class="repeating_gearkits">
						<details>
							<summary><input type="text" name="attr_gearkit" placeholder="Gear kit" data-i18n-title="gear-kit"/> 
							<input type="number" name="attr_gearcost" title="Cost in Story Points" data-i18n-title="cost-in" value="1">
							<input type="checkbox" name="attr_signatureitem" title="Character's Signature Item?" data-i18n-title="signature-item" value="1"/><input type="text" style="width: 25ch; text-align: center; border: none; background-color: #f9f9eb;  font-weight: bold; margin = 0" value="Signature item | Equipped" readonly="true"/>
							<input type="checkbox" name="attr_equipped" title="Tick if carried" data-i18n-title="tick" value="1"/></summary>
							<textarea name="attr_gearcontents" style="height:60px; width:95%;" placeholder="Contents" data-i18n-placeholder="contents" ></textarea>				
							<textarea name="attr_geartags" placeholder="Tags" data-i18n-placeholder="tags" style="height: 40px; width:95%"></textarea>
						</details>
					</fieldset>			
			</div>
			<div>
				<h3 data-i18n="visa-title">Visa Stamps /<br/>Visas /<br/>Visastempel</h3>
				<hr/>
					<textarea name="attr_journal" placeholder="Notes" data-i18n-placeholder="notes"></textarea>		
			</div>
		</div>
	</div>

	<div class="sheet-journal sheet-pc-view">
		<div class="sheet-passport">
			<div>
				<h3 data-i18n="visa-title-nowrap">Visa Stamps / Visas / Visastempel</h3>
				<textarea name="attr_journal" placeholder="Notes" data-i18n-placeholder="notes" style="height:500px;"></textarea>
			</div>
			<div>
				<h3>&nbsp;</h3>
				<textarea name="attr_journal2" placeholder="Notes" data-i18n-placeholder="notes" style="height:500px;"></textarea>
			</div>
		</div>
	</div>

	<div class="sheet-combat sheet-pc-view">
	<!--
	Set the 'value' for the PAM and RATATATAT buttons to 1 and 2 respectively and 3 and 4 for the
	 normal attack and Whump! where the value is only used as part of the roll template.
	Things seem out of order, but it allows this value to be used for the bonus damage 
	calculation in the Custom Roll Parsing reducing the number of values passed.
	-->
		<div class="sheet-passport">
			<div>
				<h2 data-i18n="combat-rolls">Combat rolls</h2> 	
				<button type="action" class="sheet-cbtroll" name="act_init_pc" title="Initiative" data-i18n-title="initiative" value="1" data-i18n="initiative">Initiative</button>
				<button type="action" class="sheet-cbtroll" name="act_defend_ranged" title="Defend with AGILITY" data-i18n-title="defend-agility" value="1" data-i18n="take-cover">Take Cover!</button>
				<button type="action" class="sheet-cbtroll" name="act_defend_melee" title="Defend with MELEE" data-i18n-title="defend-melee" value="2" data-i18n="parry">Parry!</button>
				<button type="action" class="sheet-cbtroll" name="act_recover" title="Recovery" data-i18n-title="recovery" data-i18n="recovery">Recovery</button>		
				<br />
				<hr/>
			
				<input type="text" name="attr_armour" class="sheet-short" placeholder="Armour" data-i18n-placeholder="armour"/>
				<input type="number" name="attr_soakvalue" title="Protection value" data-i18n-title="protection-value" value="0" min="0"/><span data-i18n="dP">dP</span>
				<input name="attr_armourtags" placeholder="Tags" data-i18n-placeholder="tags" style="width: 40ch"/>
				<button type="action" class="sheet-cbtroll" name="act_soak" title="Soak damage" data-i18n-title="soak-damage" value="soak" data-i18n="soak">Soak</button>	
				<br/>
				<br/>
				<input type="text" name="attr_weapon" class="sheet-short" value="Unarmed attack" readonly="true"/>
				<input name="attr_unarmedskill" class="sheet-shorter" value="Melee" readonly="true"/>
				<input type="number" name="attr_weapondmg" value="2" min="0" title="Damage Dice" data-i18n-title="damage-dice"/><span data-i18n="dX">dX</span>
				<input type="text" name="attr_unarmedtags" placeholder="Tags" data-i18n-placeholder="tags" style="width: 40ch"/>
				
				<button type="action" class="sheet-cbtroll" name="act_attack_unarmed" title="Attack!" data-i18n-title="attack!" value="3" data-i18n="attack!">Attack!</button>
				<button type="action" class="sheet-cbtroll" name="act_whump_unarmed" title="Whump!" data-i18n-title="whump!" value="4" data-i18n="whump!">Whump!</button>
			</div>
			<div>
				<fieldset class="repeating_attacks">
					<input type="text" name="attr_weapon" class="sheet-short" placeholder="Weapon" data-i18n-placeholder="weapon" /> 
					<select name="attr_weaponskill" class="sheet-shorter" style="width: 9%">
						<option value="0" data-i18n="skill">Skill</option>
						<option value="1" data-i18n="melee">Melee</option>
						<option value="2" data-i18n="ranged">Ranged</option>
					</select>
					<input class="sheet-revealbuttons" type="checkbox" name="attr_weaponskill" value="1" style="display: none"/>
					<input class="sheet-revealbuttons" type="checkbox" name="attr_weaponskill" value="2" style="display: none"/>
					<input type="number" name="attr_weapondmg" value="0" min="0" title="Damage Dice" data-i18n-title="damage-dice"><span data-i18n="dX">dX</span>

					<div class="sheet-meleebuttons">
						<input type="text" name="attr_weapontags" placeholder="Tags" data-i18n-placeholder="tags" style="width: 40ch"/>
						<button type="action" class="sheet-cbtroll" name="act_melee" title="Attack!" data-i18n-title="attack!" value="3" data-i18n="attack!">Attack!</button>
						<button type="action" class="sheet-cbtroll" name="act_whump" title="Whump!" data-i18n-title="whump!"value="4" data-i18n="whump!">Whump!</button>
					</div>
					
					<div class="sheet-rangedbuttons">
						<input type="text" name="attr_weapontags" placeholder="Tags" data-i18n-placeholder="tags" style="width: 33ch"/>				
						<input type="number" name="attr_reloadval" title="Reload: Enter lower tag value OR use 99 for single-shot" data-i18n-title="reload-info" value="99" min="0"/>				
						<button type="action" class="sheet-cbtroll" name="act_ranged" title="Attack!" data-i18n-title="attack!" value="3" data-i18n="attack!">Attack!</button>
						<button type="action" class="sheet-cbtroll" name="act_pam" title="Aimed Shot!" data-i18n-title="aimed-shot" value="1" data-i18n="pam!">Pam!</button>				
						<button type="action" class="sheet-cbtroll" name="act_rat" title="Empty the magazine!" data-i18n-title="empty" value="2" data-i18n="ratatatat!">Ratatatat!</button>					
					</div>
				</fieldset>
			</div>
		</div>
	</div>

	<footer>
		<hr/>
		<span data-i18n="image-disclaimer">'The Troubleshooters' logo and the coat of arms are &#169; Helmgast and are used here with their kind permission</span>
	</footer>
</div>

<rolltemplate class="sheet-rolltemplate-basic">
    <div class="sheet-template-container">
		<p>{{name}}</p>
		<p><span data-i18n="rolls">Rolls</span> {{dicecount}} <span data-i18n="{{dicetype}}">dicetype</span></p><br/>
		<div class="sheet-template-result">{{result}}</div>
	</div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-std">
    <table>
        <caption>{{char}} {{skill}}</caption>
            <tr><td><span data-i18n="roll">Roll</span>: {{roll1}} <span data-i18n="vs">vs</span> {{target}}</td>
			{{#rollBetween() computed::outcome 1 1}}
				<tr><td><span data-i18n="success">Success!</span></td>
			{{/rollBetween() computed::outcome 1 1}}
			{{#rollBetween() computed::outcome 2 2}}
				<tr><td><span data-i18n="failure">Zut! Failure</span></td>
			{{/rollBetween() computed::outcome 2 2}}
			{{#rollBetween() computed::outcome 3 3}}
				<tr><td><span data-i18n="good-karma">Good Karma!</span></td>
			{{/rollBetween() computed::outcome 3 3}}
			{{#rollBetween() computed::outcome 4 4}}
				<tr><td><span data-i18n="bad-karma">#$@$*#@! Bad Karma strikes!</span></td>
			{{/rollBetween() computed::outcome 4 4}}
	</table>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-init">
	<table>
		<caption>{{char}} <span data-i18n="leaps-action">leaps into action!</span></caption>
		{{#rollBetween() computed::type 1 2}}
			<tr><td><span data-i18n="roll">Roll</span>: {{roll1}} <span data-i18n="vs">vs</span> {{computed::target}}</td>
			{{#rollBetween() computed::outcome 1 1}}
				<tr><td><span data-i18n="success">Success!</span></td>
			{{/rollBetween() computed::outcome 1 1}}
			{{#rollBetween() computed::outcome 2 2}}
				<tr><td><span data-i18n="failure">Zut! Failure</span></td>
			{{/rollBetween() computed::outcome 2 2}}			
			{{#rollBetween() computed::outcome 3 3}}
				<tr><td><span data-i18n="good-karma">Good Karma!</span></td>
			{{/rollBetween() computed::outcome 3 3}}
			{{#rollBetween() computed::outcome 4 4}}
				<tr><td><span data-i18n="bad-karma">#$@$*#@! Bad Karma strikes!</span></td>
			{{/rollBetween() computed::outcome 4 4}}			
			<tr><td><span data-i18n="initiative">Initiative</span> {{computed::init}}</td>
		{{/rollBetween() computed::type 1 2}}
		{{#rollBetween() computed::type 3 3}}
			<tr><td><span data-i18n="initiative">Initiative</span> {{computed::init}}</td>
		{{/rollBetween() computed::type 3 3}}		
	<table>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-def">
	<table>
		{{#rollBetween() computed::type 1 1}}
			<caption>{{char}} <span data-i18n="takes-cover">takes cover!</span></caption>
		{{/rollBetween() computed::type 1 1}}
		{{#rollBetween() computed::type 2 2}}
			<caption>{{char}} <span data-i18n="ducks-weaves">ducks and weaves!</span></caption>
		{{/rollBetween() computed::type 2 2}}
		{{#rollBetween() computed::type 3 3}}
			<caption>{{char}} <span data-i18n="defends">defends!</span></caption>
		{{/rollBetween() computed::type 3 3}}		
		 <tr><td><span data-i18n="roll">Roll</span>: {{roll1}} <span data-i18n="vs">vs</span> {{computed::target}}</td>
		{{#rollBetween() computed::outcome 1 1}}
			<tr><td><span data-i18n="success">Success!</span></td>
		{{/rollBetween() computed::outcome 1 1}}
		{{#rollBetween() computed::outcome 2 2}}
			<tr><td><span data-i18n="failure">Zut! Failure</span></td>
		{{/rollBetween() computed::outcome 2 2}}
		{{#rollBetween() computed::outcome 3 3}}
			<tr><td><span data-i18n="good-karma">Good Karma!</span></td>
			<tr><td><span data-i18n="make-recovery-roll">Make a RECOVERY roll after any damage is applied</span></td>
		{{/rollBetween() computed::outcome 3 3}}
		{{#rollBetween() computed::outcome 4 4}}
			<tr><td><span data-i18n="bad-karma">#$@$*#@! Bad Karma strikes!</span></td>
			<tr><td><span data-i18n="knocked-prone">Knocked PRONE!</span></td>
		{{/rollBetween() computed::outcome 4 4}}
	<table>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-atk">
    <table>
		{{#rollBetween() computed::type 1 1}}		
			<caption>{{char}} <span data-i18n="takes-aim">takes aim and...PAM!</span></caption>
				<tr><td><span data-i18n="takes-aim">Roll</span>: {{roll1}} <span data-i18n="vs">vs</span> {{target}}</td>
					<tr><td><span data-i18n="reduce-ini">Reduce initiative score by 2</span></td>
					{{#rollBetween() computed::outcome 1 1}}
						<tr><td><span data-i18n="a-hit">A hit!</span></td>
						<tr><td>{{computed::bonusdamage}} <span data-i18n="damage">damage!</span></td>
					{{/rollBetween() computed::outcome 1 1}}
					{{#rollBetween() computed::outcome 2 2}}
						<tr><td><span data-i18n="miss">Zut! A miss</span></td>
					{{/rollBetween() computed::outcome 2 2}}
					{{#rollBetween() computed::outcome 3 3}}
						<tr><td><span data-i18n="good-karma-underlings">Good Karma! Underlings and Mooks are OUT COLD.</span></td>
						<tr><td>{{computed::bonusdamage}} <span data-i18n="damage">Damage!</span></td>
						<tr><td><span data-i18n="reroll-damage">Re-roll damage if you wish.</span></td>
					{{/rollBetween() computed::outcome 3 3}}
					{{#rollBetween() computed::outcome 4 4}}
						<tr><td><span data-i18n="bad-karma-minus">#$@$*#@! Bad Karma strikes! your next check is at -2 pips</span></td>
						{{#rollBetween() computed::reload 1 1}}
							<tr><td><span data-i18n="weapon-jammed">Weapon jammed!</span></td>
						{{/rollBetween() computed::reload 1 1}}						
					{{/rollBetween() computed::outcome 4 4}}
		{{/rollBetween() computed::type 1 1}}
		{{#rollBetween() computed::type 2 2}}
			<caption><span data-i18n="ratatatat">RATATATAT!</span> {{char}} <span data-i18n="empties-weapon">empties their weapon at the target</span></caption>
				<tr><td><span data-i18n="roll">Roll</span>: {{roll1}} <span data-i18n="vs">vs</span> {{target}}</td>
					{{#rollBetween() computed::outcome 1 1}}
						<tr><td><span data-i18n="a-hit-choose">A hit! Choose from</span>:</td>
						<tr><td>{{computed::damage}} <span data-i18n="damage-all">damage to all targets</span></td>
						<tr><td><span data-i18n="or">or</span></td>
						<tr><td>{{computed::bonusdamage}} <span data-i18n="damage-one">damage to one target</span></td>
					{{/rollBetween() computed::outcome 1 1}}
					{{#rollBetween() computed::outcome 2 2}}
						<tr><td><span data-i18n="miss">Zut! a miss</span></td>
					{{/rollBetween() computed::outcome 2 2}}
					{{#rollBetween() computed::outcome 3 3}}
						<tr><td><span data-i18n="good-karma-underlings">Good Karma! Underlings and Mooks are OUT COLD.</span></td>
						<tr><td><span data-i18n="choose">Choose from</span>:</td>
						<tr><td>{{computed::damage}} <span data-i18n="damage-all">damage to all targets</span></td>
						<tr><td><span data-i18n="or">or</span></td>
						<tr><td>{{computed::bonusdamage}} <span data-i18n="damage-one">damage to one target</span></td>
						<tr><td><span data-i18n="reroll-damage">Re-roll damage if you wish.</span></td>
					{{/rollBetween() computed::outcome 3 3}}
					{{#rollBetween() computed::outcome 4 4}}
						<tr><td><span data-i18n="bad-karma-minus">#$@$*#@! Bad Karma strikes! your next check is at -2 pips</span></td>
						{{#rollBetween() computed::reload 1 1}}
							<tr><td><span data-i18n="weapon-jammed">Weapon jammed!</span></td>
						{{/rollBetween() computed::reload 1 1}}						
					{{/rollBetween() computed::outcome 4 4}}
		{{/rollBetween() computed::type 2 2}}
		{{#rollBetween() computed::type 3 3}}
			<caption>{{char}} <span data-i18n="attacks!">attacks!</span></caption>
				<tr><td><span data-i18n="roll">Roll</span>: {{roll1}} <span data-i18n="vs">vs</span> {{target}}</td>
					{{#rollBetween() computed::outcome 1 1}}
						<tr><td><span data-i18n="a-hit">A hit!</span></td>
						<tr><td>{{computed::damage}} <span data-i18n="damage">damage!</span></td>
						{{#rollBetween() computed::reload 1 1}}
							<tr><td><span data-i18n="out-of-ammo">Out of ammo!</span></td>
						{{/rollBetween() computed::reload 1 1}}
					{{/rollBetween() computed::outcome 1 1}}
					{{#rollBetween() computed::outcome 2 2}}
						<tr><td><span data-i18n="miss">Zut! A miss</span></td>
						{{#rollBetween() computed::reload 1 1}}
							<tr><td><span data-i18n="out-of-ammo">Out of ammo!</span></td>
						{{/rollBetween() computed::reload 1 1}}						
					{{/rollBetween() computed::outcome 2 2}}
					{{#rollBetween() computed::outcome 3 3}}
						<tr><td><span data-i18n="good-karma-underlings">Good Karma! Underlings and Mooks are OUT COLD.</span></td>
						<tr><td>{{computed::damage}} <span data-i18n="damage">damage!</span></td>
						<tr><td><span data-i18n="reroll-damage">Re-roll damage if you wish.</span></td>
						{{#rollBetween() computed::reload 1 1}}
							<tr><td><span data-i18n="out-of-ammo">Out of ammo!</span></td>
						{{/rollBetween() computed::reload 1 1}}						
					{{/rollBetween() computed::outcome 3 3}}
					{{#rollBetween() computed::outcome 4 4}}
						<tr><td><span data-i18n="bad-karma-minus">#$@$*#@! Bad Karma strikes! your next check is at -2 pips</span></td>
						{{#rollBetween() computed::reload 1 1}}
							<tr><td><span data-i18n="weapon-jammed">Weapon jammed!</span></td>
						{{/rollBetween() computed::reload 1 1}}
					{{/rollBetween() computed::outcome 4 4}}
		{{/rollBetween() computed::type 3 3}}
		{{#rollBetween() computed::type 4 4}}
			<caption><span data-i18n="whump!">WHUMP!</span> {{char}} <span data-i18n="attempts-takedown">attempts a takedown</span></caption>
				<tr><td><span data-i18n="roll">Roll</span>: {{roll1}} <span data-i18n="vs">vs</span> {{target}}</td>			
					{{#rollBetween() computed::outcome 1 1}}
						<tr><td><span data-i18n="success-choose-two">Success! Choose two from</span>:</td>
						<tr><td>{{computed::wdamage}} <span data-i18n="damage">damage!</span></td>
						<tr><td><span data-i18n="target-restrained">The target is RESTRAINED</span></td>
						<tr><td><span data-i18n="target-prone">The target is PRONE</span></td>
					{{/rollBetween() computed::outcome 1 1}}
					{{#rollBetween() computed::outcome 2 2}}
						<tr><td><span data-i18n="failure">Zut! Failure</span></td>
					{{/rollBetween() computed::outcome 2 2}}
					{{#rollBetween() computed::outcome 3 3}}
						<tr><td><span data-i18n="good-karma-underlings">Good Karma! Underlings and Mooks are OUT COLD.</span></td>
						<tr><td><span data-i18n="choose-two">Choose two from</span>:</td>
						<tr><td>{{computed::wdamage}} <span data-i18n="damage">damage!</span></td>
						<tr><td><span data-i18n="target-restrained">The target is RESTRAINED</span></td>
						<tr><td><span data-i18n="target-prone">The target is PRONE</span></td>
						<tr><td><span data-i18n="reroll-damage">Re-roll damage if you wish.</span></td>
					{{/rollBetween() computed::outcome 3 3}}
					{{#rollBetween() computed::outcome 4 4}}
						<tr><td><span data-i18n="bad-karma-minus">#$@$*#@! Bad Karma strikes! your next check is at -2 pips</span></td>
					{{/rollBetween() computed::outcome 4 4}}
		{{/rollBetween() computed::type 4 4}}
		{{#rollBetween() computed::type 5 5}}
			<caption>{{char}} <span data-i18n="attacks-with">attacks with</span> {{atktxt}}!</caption>
				<tr><td><span data-i18n="roll">Roll</span>: {{roll1}} <span data-i18n="vs">vs</span> {{target}}</td>
					{{#rollBetween() computed::outcome 1 1}}
						<tr><td><span data-i18n="a-hit">A hit!</span></td>
						<tr><td>{{computed::damage}} <span data-i18n="damage">damage!</span></td>
						{{#rollBetween() computed::reload 1 1}}
							<tr><td><span data-i18n="out-of-ammo">Out of ammo!</span></td>
						{{/rollBetween() computed::reload 1 1}}
					{{/rollBetween() computed::outcome 1 1}}
					{{#rollBetween() computed::outcome 2 2}}
						<tr><td><span data-i18n="miss">Zut! A miss</span></td>
						{{#rollBetween() computed::reload 1 1}}
							<tr><td><span data-i18n="out-of-ammo">Out of ammo!</span></td>
						{{/rollBetween() computed::reload 1 1}}						
					{{/rollBetween() computed::outcome 2 2}}
					{{#rollBetween() computed::outcome 3 3}}
						<tr><td><span data-i18n="good-karma-underlings">Good Karma! Underlings and Mooks are OUT COLD.</span></td>
						<tr><td>{{computed::damage}} <span data-i18n="damage">damage!</span></td>
						<tr><td><span data-i18n="reroll-damage">Re-roll damage if you wish.</span></td>
						{{#rollBetween() computed::reload 1 1}}
							<tr><td><span data-i18n="out-of-ammo">Out of ammo!</span></td>
						{{/rollBetween() computed::reload 1 1}}						
					{{/rollBetween() computed::outcome 3 3}}
					{{#rollBetween() computed::outcome 4 4}}
						<tr><td><span data-i18n="bad-karma-minus">#$@$*#@! Bad Karma strikes! your next check is at -2 pips</span></td>
						{{#rollBetween() computed::reload 1 1}}
							<tr><td><span data-i18n="weapon-jammed">Weapon jammed!</span></td>
						{{/rollBetween() computed::reload 1 1}}
					{{/rollBetween() computed::outcome 4 4}}
		{{/rollBetween() computed::type 5 5}}		
		<table>
	</rolltemplate>

<rolltemplate class="sheet-rolltemplate-soakrecover">
    <table>
        <caption>{{char}}</caption>
			{{#rollBetween() computed::type 1 1}}
				<tr><td><span data-i18n="soaks">Soaks</span> {{computed::soak}} <span data-i18n="points-of-damage">points of damage</span></td>
			{{/rollBetween() computed::type 1 1}}
			{{#rollBetween() computed::type 2 2}}
				<tr><td><span data-i18n="recovers">Recovers</span> {{computed::recover}} <span data-i18n="points-of-vitality">points of vitality</span></td>
			{{/rollBetween() computed::type 2 2}}
    <table>
</rolltemplate>

<script type="text/worker">
//Attributes for multilanguage support in roll queries

on("sheet:opened", function(eventInfo){    
    setAttrs({
        how_many_dice: getTranslationByKey("how-many-dice"),
    });    
});


//Set max Vitality based on skill values    
    on("change:agility change:melee change:rangedcombat change:vitality_npc_max sheet:opened", function() {
        getAttrs(["agility","melee","rangedcombat","vitality_npc_max"], function(values) {
			var agi = parseInt(values["agility"])||0;
			var mel = parseInt(values["melee"])||0;
			var rng = parseInt(values["rangedcombat"])||0;
			var npc = parseInt(values["vitality_npc_max"])||0;
			
			let agimod = 0;
			if(agi > 64) agimod = 2;
			else if(agi > 44) agimod = 1;
			
			let cbtmod = 0;
			if(mel > 64 || rng > 64) cbtmod = 2;			
			else if(mel > 44 || rng > 44) cbtmod = 1;

			let mod = 4;
			if (npc > 0) mod = npc;
			else if(agimod == 2 && cbtmod == 2) mod = 7;	
			else if(agimod == 2 || cbtmod == 2) mod = 6;			
			else if(agimod == 1 && cbtmod == 1) mod = 5;			
			else if(agimod == 1 || cbtmod == 1) mod = 5;
						
			setAttrs({
                vitality_max: mod
            });
        });
	});

//Modify max Vitality if exhausted	
    on("change:exhausted1 change:exhausted2 change:exhausted3 change:vitality_max sheet:opened", function() {
        getAttrs(["exhausted1","exhausted2","exhausted3","vitality_max"], function(values) {
			var ex1 = parseInt(values.exhausted1)||0;
			var ex2 = parseInt(values.exhausted2)||0;
			var ex3 = parseInt(values.exhausted3)||0;
			var vmax = parseInt(values.vitality_max)||0;
			
			let ex = ex1 + ex2 + ex3;
			let newmax = vmax
			if(ex == 3) newmax = Math.ceil(vmax/2);
			else if(ex == 6) newmax = Math.ceil(vmax / 4);			
			else if(ex == 9) newmax = Math.ceil(vmax / 8);			
						
			setAttrs({
                vitality_max_vis: newmax
            });
        });
	});

//Regular skill rolls
	on('clicked:skillroll clicked:gennpc clicked:specnpc', (event) => {		
        const rolltext = "&{template:std} {{char=@{name}}} {{skill="+getTranslationByKey(event.htmlAttributes.value)+"}} {{target=[[@{"+event.htmlAttributes.title+"}]]}} {{roll1=[[1d100]]}} {{outcome=[[0]]}} {{karma=[[0]]}} {{pips=[[?{"+getTranslationByKey("total-pips")+"|0}]]}}"
		startRoll(rolltext, (results) => {
            const total = results.results.roll1.result
            const tens = Math.floor(total / 10);
			const ones = total % 10;
			const target = results.results.target.result;
			const pips = results.results.pips.result;
			const invpips = pips * -1;
			var tens2 = tens
			var krm = 0;
			var out = 0;
			if (tens == 10) {
				tens2 = 0;
			}
			if (pips > 0 && ones > 0 && pips >= ones && tens2 == ones) {
				out = 3;
			}
			else if (pips > 0 && ones > 0 && pips >= ones) {
				out = 1;
			}
			else if (invpips > 0 && ones > 0 && invpips >= ones && tens2 == ones) {
				out = 4;
			}
			else if (invpips > 0 && ones > 0 && invpips >= ones) {
				out = 2;
			}
			else if (total <= target && tens2 == ones) {
				out = 3;
				}
			else if (total > target && tens2 == ones) {
				out = 4;
				}
			else if (total <= target) {
				out = 1;
				}
			else if (total > target) {
				out = 2;
			}
            finishRoll(
                results.rollId,
                {
					outcome: out,
                }
            );
        });
    });

//NPC skill rolls
	on('clicked:repeating_skills:skillnpc', (event) => {
        const trigger = event.triggerName.slice(8);  // this always starts with 'clicked:'
		const prefix = trigger.startsWith('repeating_') ? trigger.split('_').slice(0,3).join('_') + '_' : '' // prefix gets an empty string for normal attributes, and repeating_section_ID_ for repeating attributes 
		let txtVal = "@{npcskilltext}";
        let txtPart = txtVal.replaceAll('@{', `@{${prefix}`);		
		let tgtVal = "@{skillnpc}";
        let tgtPart = tgtVal.replaceAll('@{', `@{${prefix}`);
        const rolltext = "&{template:std} {{char=@{character_name}}} {{skill="+getTranslationByKey("rolls-to")+" "+txtPart+"}} {{target=[["+tgtPart+"]]}} {{roll1=[[1d100]]}} {{outcome=[[0]]}} {{pips=[[?{"+getTranslationByKey("total-pips")+"|0}]]}}"
		startRoll(rolltext, (results) => {
            const total = results.results.roll1.result
            const tens = Math.floor(total / 10);
			const ones = total % 10;
			const target = results.results.target.result;
			const pips = results.results.pips.result;
			const invpips = pips * -1;
			var tens2 = tens
			var krm = 0;
			var out = 0;
			if (tens == 10) {
				tens2 = 0;
			}
			if (pips > 0 && ones > 0 && pips >= ones && tens2 == ones) {
				out = 3;
			}
			else if (pips > 0 && ones > 0 && pips >= ones) {
				out = 1;
			}
			else if (invpips > 0 && ones > 0 && invpips >= ones && tens2 == ones) {
				out = 4;
			}
			else if (invpips > 0 && ones > 0 && invpips >= ones) {
				out = 2;
			}
			else if (total <= target && tens2 == ones) {
				out = 3;
				}
			else if (total > target && tens2 == ones) {
				out = 4;
				}
			else if (total <= target) {
				out = 1;
				}
			else if (total > target) {
				out = 2;
			}
            finishRoll(
                results.rollId,
                {
					outcome: out,
                }
            );
        });
    });


//Melee combat rolls
	on('clicked:attack_unarmed clicked:whump_unarmed clicked:repeating_attacks:melee clicked:repeating_attacks:whump', (event) => {
        const trigger = event.triggerName.slice(8);  // this always starts with 'clicked:'
		const prefix = trigger.startsWith('repeating_') ? trigger.split('_').slice(0,3).join('_') + '_' : '' // prefix gets an empty string for normal attributes, and repeating_section_ID_ for repeating attributes 
		let dmgVal = "@{weapondmg}";
        let dmgPart = dmgVal.replaceAll('@{', `@{${prefix}`);
		const rolltext = "&{template:atk} {{char=@{name}}} {{target=[[@{melee}]]}} {{roll1=[[1d100]]}} {{outcome=[[0]]}} {{pips=[[?{"+getTranslationByKey("total-pips")+"|0}]]}} {{type=[["+event.htmlAttributes.value+"]]}} {{damage=[["+dmgPart+"d6!>6>4]]}} {{wdamage=[[1d6!>6>4]]}} {{reload=[[0]]}}"
		startRoll(rolltext, (results) => {
			const total = results.results.roll1.result;
            const tens = Math.floor(total / 10);
			const ones = total % 10;
			const target = results.results.target.result;
			const pips = results.results.pips.result;
			const invpips = pips * -1;
			const dmg = results.results.damage.result;
			const wdmg = results.results.wdamage.result;
			var tens2 = tens;
			var out = 0;
			if (tens == 10) {
				tens2 = 0;
			}
			if (pips > 0 && ones > 0 && pips >= ones && tens2 == ones) {
				out = 3;
			}
			else if (pips > 0 && ones > 0 && pips >= ones) {
				out = 1;
			}
			else if (invpips > 0 && ones > 0 && invpips >= ones && tens2 == ones) {
				out = 4;
			}
			else if (invpips > 0 && ones > 0 && invpips >= ones) {
				out = 2;
			}
			else if (total <= target && tens2 == ones) {
				out = 3;
			}
			else if (total > target && tens2 == ones) {
				out = 4;
			}
			else if (total <= target) {
				out = 1;
			}
			else if (total > target) {
				out = 2;
			}
            finishRoll(
                results.rollId,
                {
					outcome: out,
					damage: dmg,
					wdamage: wdmg,
                }
            );
        });
    });

//Ranged combat rolls
	on('clicked:repeating_attacks:ranged clicked:repeating_attacks:pam clicked:repeating_attacks:rat', (event) => {
	const trigger = event.triggerName.slice(8);  // this always starts with 'clicked:'
		const prefix = trigger.startsWith('repeating_') ? trigger.split('_').slice(0,3).join('_') + '_' : '' // prefix gets an empty string for normal attributes, and repeating_section_ID_ for repeating attributes 
		let dmgVal = "@{weapondmg}";
        let dmgPart = dmgVal.replaceAll('@{', `@{${prefix}`);
		let relVal = "@{reloadval}";
		let relPart = relVal.replaceAll('@{', `@{${prefix}`);
		const rolltext = "&{template:atk} {{char=@{name}}} {{target=[[@{rangedcombat}]]}} {{roll1=[[1d100]]}} {{outcome=[[0]]}} {{pips=[[?{"+getTranslationByKey("total-pips")+"|0}]]}} {{type=[["+event.htmlAttributes.value+"]]}} {{damage=[["+dmgPart+"d6!>6>4]]}} {{bonusdamage=[["+event.htmlAttributes.value+"d6!>6>4]]}} {{reload=[["+relPart+"]]}}"
		startRoll(rolltext, (results) => {
			const total = results.results.roll1.result;
            const tens = Math.floor(total / 10);
			const ones = total % 10;
			const target = results.results.target.result;
			const pips = results.results.pips.result;
			const invpips = pips * -1;
			const dmg = results.results.damage.result;			
			var rld = results.results.reload.result;
			var bonusdmg = results.results.bonusdamage.result;
			var tens2 = tens;
			var out = 0;
			let bondmg = dmg + bonusdmg;
			if (tens == 10) {
				tens2 = 0;
			}
			if (rld < 99 && rld <= ones) {
				rld = 1;
			}
			if (ones == 0) {
				rld = 1;
			}
			if (pips > 0 && ones > 0 && pips >= ones && tens2 == ones) {
				out = 3;
			}
			else if (pips > 0 && ones > 0 && pips >= ones) {
				out = 1;
			}
			else if (invpips > 0 && ones > 0 && invpips >= ones && tens2 == ones) {
				out = 4;
			}
			else if (invpips > 0 && ones > 0 && invpips >= ones) {
				out = 2;
			}
			else if (total <= target && tens2 == ones) {
				out = 3;
				}
			else if (total > target && tens2 == ones) {
				out = 4;
				}
			else if (total <= target) {
				out = 1;
				}
			else if (total > target) {
				out = 2;
			}
            finishRoll(
                results.rollId,
                {
					outcome: out,
					damage: dmg,
					bonusdamage: bondmg,
					reload: rld,
                }
            );
        });
    });

//NPC combat rolls
	on('clicked:repeating_attacks:atknpc', (event) => {
	const trigger = event.triggerName.slice(8);  // this always starts with 'clicked:'
		const prefix = trigger.startsWith('repeating_') ? trigger.split('_').slice(0,3).join('_') + '_' : '' // prefix gets an empty string for normal attributes, and repeating_section_ID_ for repeating attributes 
		let dmgVal = "@{npcweapondmg}";
        let dmgPart = dmgVal.replaceAll('@{', `@{${prefix}`);
		let relVal = "@{npcreloadval}";
		let relPart = relVal.replaceAll('@{', `@{${prefix}`);
		let tgtVal = "@{npcattack}";
		let tgtPart = tgtVal.replaceAll('@{', `@{${prefix}`);
		let txtVal = "@{npcatktxt}";
		let txtPart = txtVal.replaceAll('@{', `@{${prefix}`);		
		const rolltext = "&{template:atk} {{char=@{name}}} {{atktxt="+txtPart+"}} {{target=[["+tgtPart+"]]}} {{roll1=[[1d100]]}} {{outcome=[[0]]}} {{pips=[[?{"+getTranslationByKey("total-pips")+"|0}]]}} {{type=[[5]]}} {{damage=[["+dmgPart+"d6!>6>4]]}} {{reload=[["+relPart+"]]}}"
		startRoll(rolltext, (results) => {
			const total = results.results.roll1.result;
            const tens = Math.floor(total / 10);
			const ones = total % 10;
			const target = results.results.target.result;
			const pips = results.results.pips.result;
			const invpips = pips * -1;
			const dmg = results.results.damage.result;			
			var rld = results.results.reload.result;
			var tens2 = tens;
			var out = 0;
			if (tens == 10) {
				tens2 = 0;
			}
			if (rld < 99 && (rld <= ones || ones == 0)) {
				rld = 1;
			}
			if (pips > 0 && ones > 0 && pips >= ones && tens2 == ones) {
				out = 3;
			}
			else if (pips > 0 && ones > 0 && pips >= ones) {
				out = 1;
			}
			else if (invpips > 0 && ones > 0 && invpips >= ones && tens2 == ones) {
				out = 4;
			}
			else if (invpips > 0 && ones > 0 && invpips >= ones) {
				out = 2;
			}
			else if (total <= target && tens2 == ones) {
				out = 3;
				}
			else if (total > target && tens2 == ones) {
				out = 4;
				}
			else if (total <= target) {
				out = 1;
				}
			else if (total > target) {
				out = 2;
			}
            finishRoll(
                results.rollId,
                {
					outcome: out,
					damage: dmg,
					reload: rld,
                }
            );
        });
    });

//Soak and recovery rolls
	on('clicked:soak', (info) => {
        const rolltext = "&{template:soakrecover} {{char=@{name}}} {{soak=[[@{soakvalue}d6>4]]}} {{type=[[1]]}}"
		startRoll(rolltext, (results) => {
			const soaked = results.results.soak.result;
            finishRoll(
                results.rollId,
                {
                    soak: soaked,
                }
            );
        });
    });

	on('clicked:recover', (info) => {
        const rolltext = "&{template:soakrecover} {{char=@{name}}} {{recover=[[?{"+getTranslationByKey("how-many-recovery-dice")+"}d6>4]]}}  {{type=[[2]]}}"
		startRoll(rolltext, (results) => {
            const recovered = results.results.recover.result;
            finishRoll(
                results.rollId,
                {
					recover: recovered,
                }
            );
        });
    });

//Defence rolls
	on('clicked:defend_ranged clicked:defend_melee clicked:def_npc', (event) => {
		const rolltext = "&{template:def} {{char=@{name}}} {{targetm=[[@{melee}]]}} {{targetr=[[@{agility}]]}} {{targetn=[[@{npcdefence}]]}} {{target=[[0]]}} {{roll1=[[1d100]]}} {{outcome=[[0]]}} {{pips=[[?{"+getTranslationByKey("total-pips")+"|0}]]}} {{type=[["+event.htmlAttributes.value+"]]}}"
		startRoll(rolltext, (results) => {
			const total = results.results.roll1.result;
            const tens = Math.floor(total / 10);
			const ones = total % 10;
			const tgtm = results.results.targetm.result;
			const tgtr = results.results.targetr.result;
			const tgtn = results.results.targetn.result;
			const pips = results.results.pips.result;
			const invpips = pips * -1;
			const rolltype = results.results.type.result;
			var tens2 = tens;
			var out = 0;
			var tgt = tgtm;
			if (rolltype == 1) {
				tgt = tgtr;
			}
			else if (rolltype == 3) {
				tgt = tgtn;
			}
			if (tens == 10) {
				tens2 = 0;
			}
			if (pips > 0 && ones > 0 && pips >= ones && tens2 == ones) {
				out = 3;
			}
			else if (pips > 0 && ones > 0 && pips >= ones) {
				out = 1;
			}
			else if (invpips > 0 && ones > 0 && invpips >= ones && tens2 == ones) {
				out = 4;
			}
			else if (invpips > 0 && ones > 0 && invpips >= ones) {
				out = 2;
			}
			else if (total <= tgt && tens2 == ones) {
				out = 3;
			}
			else if (total > tgt && tens2 == ones) {
				out = 4;
			}
			else if (total <= tgt) {
				out = 1;
			}
			else if (total > tgt) {
				out = 2;
			}
            finishRoll(
                results.rollId,
                {
					outcome: out,
					target: tgt,
                }
            );
        });
    });
	
//Initiative rolls	
	
	on('clicked:init_pc clicked:init_npc',async (event)=>{
	const rollText = "&{template:init} {{char=@{character_name}}} {{target=[[@{alertness}]]}}  {{target2=[[@{npcinitiative}]]}} {{type=[["+event.htmlAttributes.value+"]]}} {{roll1=[[1d100]]}} {{outcome=[[0]]}} {{init=[[0]]}} {{pips=[[?{"+getTranslationByKey("total-pips")+"|0}]]}}"
	const displayRoll = await startRoll(rollText);
            const total = displayRoll.results.roll1.result
            const tens = Math.floor(total / 10); //Tens
			const ones = total % 10; //placeholder
			const tgt1 = displayRoll.results.target.result;
			const tgt2 = displayRoll.results.target2.result;
			const pips = displayRoll.results.pips.result;
			const invpips = pips * -1;
			const rolltype = displayRoll.results.type.result;
			var tens2 = tens;
			var ones2 = ones;
			var tgt = tgt1
			var out = 0;
			var ini = 0;
			if (tens == 10) {
				tens2 = 0;
			}
			if (ones == 0) {
				ones2 = 10;
			}
			if (rolltype == 2) {
				tgt = tgt2;
			}
			if (pips > 0 && ones > 0 && pips >= ones && tens2 == ones) {
				out = 3;
				ini = 10 + tens + ones2;
			}
			else if (pips > 0 && ones > 0 && pips >= ones) {
				out = 1;
				ini = tens + ones2;
			}
			else if (invpips > 0 && ones > 0 && invpips >= ones && tens2 == ones) {
				out = 4;
				ini = 0;
			}
			else if (invpips > 0 && ones > 0 && invpips >= ones) {
				out = 2;
				ini = ones2;
			}
			else if (total <= tgt && tens2 == ones) {
				out = 3;
				ini = 10 + tens + ones2;
				}
			else if (total > tgt && tens2 == ones) {
				out = 4;
				ini = 0;
				}
			else if (total <= tgt) {
				out = 1;
				ini = tens + ones2;
				}
			else if (total > tgt) {
				out = 2;
				ini = ones2;
			}	
	//let trueInitiative = displayRoll.results.init.result*5.5/displayRoll.results.init.result;//some random math to demonstrate
			finishRoll(
				displayRoll.rollId,
					{
						outcome: out,
						init: ini,
						target: tgt,
					});//Finish of the display roll so that the roll is displayed to the players
			const trackerRoll = await startRoll(`![[${ini}&{tracker}]]`);//Now send the calculated roll to the tracker. Doing it as an API command by starting it with '!' will make it invisible to the players
			finishRoll(trackerRoll.rollId);//finish the tracker roll immediately since we aren't going to do any manipulation of it
});

	on('clicked:init_npcfix', async (event)=>{
	const rollText = "&{template:init} {{char=@{character_name}}} {{init=[[@{npcinitiative}]]}} {{type=[[3]]}}"
	const displayRoll = await startRoll(rollText);
            const ini = displayRoll.results.init.result
	//let trueInitiative = displayRoll.results.init.result*5.5/displayRoll.results.init.result;//some random math to demonstrate
			finishRoll(
				displayRoll.rollId,
					{
						init:ini,
					});//Finish of the display roll so that the roll is displayed to the players
			const trackerRoll = await startRoll(`![[${ini}&{tracker}]]`);//Now send the calculated roll to the tracker. Doing it as an API command by starting it with '!' will make it invisible to the players
			finishRoll(trackerRoll.rollId);//finish the tracker roll immediately since we aren't going to do any manipulation of it
});
</script>